# Zero 用户管理系统

我的设计目标是打造一个完善的，可扩展的，灵活的，可复用的用户管理系统。该系统的组织结构为如下树形结构：
UserType -> Platform -> User -> UserAuth
（符号“->”表示“一对多”）

## 用户 User
我将系统中全部的用户都存储在一张users数据表上，每一行表示一个独一无二的用户，用户的id通过自增主键表示

## 用户类别 UserType
每一个用户都必须隶属于且仅隶属于一个用户类别users_type。开发者可以根据需要设定多种不同的用户类别。我目前设定了三种最常用的用户类别（general, staff, admin），并且可能会在未来追加更多用户类别。

### 普通个人用户 General
普通个人用户通过邮件或短信等方式注册产生。个人用户通过系统的门户网站或公共App来登陆并使用系统。

### 企业员工用户 Staff
企业员工用户无法通过注册方式产生，而是通过企业系统管理者分配产生。他们通过使用为该企业定制的一个企业用户登陆终端来登陆并使用系统。

### 系统管理员 Admin
系统管理员是系统运营者和管理者，他们控制全套系统。

## 用户平台名 platformName
每个用户类别下都允许存在多个相互独立的用户平台。举例来说，假设存在A和B两家餐厅，每家餐厅的员工用户的用户类别UserType都属于企业员工用户Staff，但他们有各自的员工登陆页面，并且A餐厅的员工账户用户名可能和B餐厅的重名，因此他们是两个不同的用户平台。

* 用户平台名只允许包括大小字母加数字
* 不同用户类别下可能出现相同的用户平台名
* 一个用户平台下不可能出现两个相同的用户名

## 用户授权 UserAuth
每一个用户平台下都可包含多名用户，而每个用户都可能包含多个用户授权。换句话说，某用户可能同时具备多种登陆方式，比如邮件登陆，微信登陆，电话号登陆等。每一种登陆方式对应于一个用户授权。

* 每一个用户授权在全系统中都是唯一的，并且具备唯一主键userAuthId
* userAuthId的格式为{UserType}:{platformName}:{username}
* 当username为email时必须去掉其中的“.”并且转化为全小写
* 当username为telephone时，需要添加区号前缀以解决国际化问题
* google登陆和facebook登陆等可获得email的第三方登陆方式都一并归类为邮件授权
* 不支持username相同的两种不同用户授权


## 访问令牌 AccessToken
每一个用户都需要在登陆时获取一个AccessToken，并在登出前的每一次访问系统时都使用该token来访问系统。一个用户可能同时具备多个token，也就是多终端同时登陆。

* 客户端必须将AccessToken存储在安全保密的地方
* 每一个Token都需要设定有效期
* 允许系统延长Token的有效期
* 系统管理员可能在Token有效期到期前销毁Token
* 客户端向服务器发起的每个请求都最多只能包含一个Token
* 允许客户端同时持有多个Token，比如单终端多用户登陆

## 权限 Permission
系统中的每一组功能都可以对应于某一种权限。当某用户符合这一权限的时候，系统就允许该用户执行操作。若用户不具备相关权限，系统会返回403错误。

* 任何系统都会包含一些资源是无须权限的
* 没有加入权限控制的系统功能被默示为无须权限

## 用户角色 UserRole
用户角色是用户权限的集合。比如论坛版主是一个用户角色，他的权限包含对整个板块的读贴、发帖、删帖。

* 存在名称不同但权限相同的用户角色
* 存在为空集的用户角色（不包含任何权限），可用来访问无须权限的资源
* 不同用户角色所包含的权限可能存在交集
* 允许一个用户同时兼任多个角色，用户权限取并集
